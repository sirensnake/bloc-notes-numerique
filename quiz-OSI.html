<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz ModÃ¨le OSI</title>
  <link rel="stylesheet" href="quiz-styles.css">
</head>
<body>
  <h1>Quiz Interactif : ModÃ¨le OSI</h1>
  <form id="quizForm">
    <!-- Q1 -->
    <div class="question" data-answer="q1-3" role="group" aria-labelledby="q1-text">
      <p id="q1-text"><strong>1. Ã€ quelle couche OSI appartient la rÃ©solution DNS ?</strong></p>
      <div class="answers">
        <label for="q1-1"><input type="radio" name="q1" id="q1-1"> 1 â€“ Physique</label><br>
        <label for="q1-2"><input type="radio" name="q1" id="q1-2"> 2 â€“ Liaison</label><br>
        <label for="q1-3"><input type="radio" name="q1" id="q1-3"> 3 â€“ RÃ©seau</label><br>
        <label for="q1-4"><input type="radio" name="q1" id="q1-4"> 4 â€“ Transport</label>
      </div>
    </div>
    <!-- Q2 -->
    <div class="question" data-answer="q2-4" role="group" aria-labelledby="q2-text">
      <p id="q2-text"><strong>2. Quel protocole de transport assure une connexion fiable et ordonnÃ©e ?</strong></p>
      <div class="answers">
        <label for="q2-1"><input type="radio" name="q2" id="q2-1"> UDP</label><br>
        <label for="q2-2"><input type="radio" name="q2" id="q2-2"> ICMP</label><br>
        <label for="q2-3"><input type="radio" name="q2" id="q2-3"> ARP</label><br>
        <label for="q2-4"><input type="radio" name="q2" id="q2-4"> TCP</label>
      </div>
    </div>
    <!-- Q3 -->
    <div class="question" data-answer="q3-1" role="group" aria-labelledby="q3-text">
      <p id="q3-text"><strong>3. Dans quelle couche se situe le cÃ¢ble Ethernet ?</strong></p>
      <div class="answers">
        <label for="q3-1"><input type="radio" name="q3" id="q3-1"> 1 â€“ Physique</label><br>
        <label for="q3-2"><input type="radio" name="q3" id="q3-2"> 2 â€“ Liaison</label><br>
        <label for="q3-3"><input type="radio" name="q3" id="q3-3"> 3 â€“ RÃ©seau</label><br>
        <label for="q3-4"><input type="radio" name="q3" id="q3-4"> 4 â€“ Transport</label>
      </div>
    </div>
    <!-- Q4 -->
    <div class="question" data-answer="q4-2" role="group" aria-labelledby="q4-text">
      <p id="q4-text"><strong>4. Ã€ quelle couche se trouve le chiffrement SSL/TLS ?</strong></p>
      <div class="answers">
        <label for="q4-1"><input type="radio" name="q4" id="q4-1"> 5 â€“ Session</label><br>
        <label for="q4-2"><input type="radio" name="q4" id="q4-2"> 6 â€“ PrÃ©sentation</label><br>
        <label for="q4-3"><input type="radio" name="q4" id="q4-3"> 7 â€“ Application</label><br>
        <label for="q4-4"><input type="radio" name="q4" id="q4-4"> 4 â€“ Transport</label>
      </div>
    </div>
    <!-- Q5 -->
    <div class="question" data-answer="q5-2" role="group" aria-labelledby="q5-text">
      <p id="q5-text"><strong>5. Quelle couche gÃ¨re l'ouverture et la fermeture des sessions (ex : login) ?</strong></p>
      <div class="answers">
        <label for="q5-1"><input type="radio" name="q5" id="q5-1"> 4 â€“ Transport</label><br>
        <label for="q5-2"><input type="radio" name="q5" id="q5-2"> 5 â€“ Session</label><br>
        <label for="q5-3"><input type="radio" name="q5" id="q5-3"> 6 â€“ PrÃ©sentation</label><br>
        <label for="q5-4"><input type="radio" name="q5" id="q5-4"> 7 â€“ Application</label>
      </div>
    </div>
    <!-- Q6 -->
    <div class="question" data-answer="q6-4" role="group" aria-labelledby="q6-text">
      <p id="q6-text"><strong>6. Ã€ quelle couche se trouve un navigateur web comme Firefox ?</strong></p>
      <div class="answers">
        <label for="q6-1"><input type="radio" name="q6" id="q6-1"> 4 â€“ Transport</label><br>
        <label for="q6-2"><input type="radio" name="q6" id="q6-2"> 5 â€“ Session</label><br>
        <label for="q6-3"><input type="radio" name="q6" id="q6-3"> 6 â€“ PrÃ©sentation</label><br>
        <label for="q6-4"><input type="radio" name="q6" id="q6-4"> 7 â€“ Application</label>
      </div>
    </div>

    <div id="quiz-form-buttons">
      <button type="button" onclick="calculateScore()">Valider mes rÃ©ponses</button>
    </div>
    
    <div id="result"></div>
    <div id="timer"></div>
    <div id="progress"><div id="bar"></div></div>
    
    <div id="quiz-form-buttons">
      <button type="button" id="resetBtn" onclick="resetQuiz()">Recommencer le quiz</button>
      <button type="button" id="reviewBtn" onclick="reviewMissed()" style="display:none">Revoir les erreurs</button>
      <button type="button" id="exportBtn" onclick="exportResults()">Exporter les rÃ©sultats</button>
    </div>
  </form>
  <div class="back-container">
    <a href="quiz-sommaire.html" class="back">Retour au sommaire</a>
  </div>
  

<script>
let startTime;

const explanations={
 q1:"Le DNS fonctionne Ã  la couche RÃ©seau (3) car il convertit les noms en adresses IP.",
 q2:"TCP (couche 4) offre une transmission fiable et ordonnÃ©e.",
 q3:"Les supports physiques (cÃ¢ble, fibre) appartiennent Ã  la couche 1.",
 q4:"Le chiffrement SSL/TLS est appliquÃ© Ã  la couche PrÃ©sentation (6).",
 q5:"La couche Session (5) gÃ¨re l'Ã©tablissement et la terminaison des sessions.",
 q6:"Les applications comme les navigateurs opÃ¨rent Ã  la couche 7."};

function startTimer() {
  startTime = new Date();
}

function endTimer() {
  const endTime = new Date();
  const duration = Math.round((endTime - startTime) / 1000);
  document.getElementById('timer').textContent = `Temps: ${duration}s`;
}

function calculateScore() {
  // VÃ©rifier les questions non rÃ©pondues
  const unanswered = [];
  const questions = document.querySelectorAll('.question');
  questions.forEach((q, i) => {
    const checked = q.querySelector('input:checked');
    if (!checked) {
      unanswered.push(i + 1);
    }
  });
  
  if (unanswered.length > 0) {
    if (!confirm(`Questions ${unanswered.join(', ')} non rÃ©pondues. Voulez-vous continuer ?`)) {
      return;
    }
  }
  
  let s = 0;
  const mistakes = [];
  
  questions.forEach((q, i) => {
    const ok = q.dataset.answer;
    const ch = q.querySelector('input:checked');
    q.querySelectorAll('label').forEach(l => l.classList.remove('correct-answer', 'wrong-answer'));
    
    const k = `q${i+1}`;
    const exp = document.createElement('div');
    exp.className = 'explanation';
    exp.textContent = explanations[k] || '';
    
    if (ch) {
      if (ch.id === ok) {
        s++;
        ch.parentNode.classList.add('correct-answer');
      } else {
        ch.parentNode.classList.add('wrong-answer');
        q.querySelector(`#${ok}`).parentNode.classList.add('correct-answer');
        mistakes.push(i + 1);
      }
    } else {
      q.querySelector(`#${ok}`).parentNode.classList.add('correct-answer');
      mistakes.push(i + 1);
    }
    
    if (!q.querySelector('.explanation')) q.appendChild(exp);
  });
  
  endTimer();
  
  const pct = (s / questions.length) * 100;
  document.getElementById('result').textContent = `ðŸŽ¯ Votre score : ${s}/${questions.length}`;
  document.getElementById('bar').style.width = pct + '%';
  
  localStorage.setItem('quiz_osi_score', s);
  localStorage.setItem('quiz_osi_total', questions.length);
  
  // Afficher le bouton de rÃ©vision si nÃ©cessaire
  const reviewBtn = document.getElementById('reviewBtn');
  if (mistakes.length > 0) {
    reviewBtn.style.display = 'inline-block';
  }
}

function resetQuiz() {
  document.getElementById('quizForm').reset();
  document.getElementById('result').textContent = '';
  document.getElementById('timer').textContent = '';
  document.getElementById('bar').style.width = '0';
  document.getElementById('reviewBtn').style.display = 'none';
  
  document.querySelectorAll('.question').forEach(q => {
    q.querySelectorAll('label').forEach(l => l.classList.remove('correct-answer', 'wrong-answer'));
    const e = q.querySelector('.explanation');
    if (e) e.remove();
  });
  
  startTimer();
}

function reviewMissed() {
  const wrongQuestions = [];
  document.querySelectorAll('.question').forEach((q, i) => {
    if (q.querySelector('.wrong-answer') || !q.querySelector('.correct-answer')) {
      wrongQuestions.push(i + 1);
    }
  });
  
  alert(`Questions Ã  revoir: ${wrongQuestions.join(', ')}`);
}

function exportResults() {
  const data = {
    quiz: "ModÃ¨le OSI",
    date: new Date().toISOString(),
    score: localStorage.getItem('quiz_osi_score'),
    total: localStorage.getItem('quiz_osi_total'),
    percentage: parseInt(localStorage.getItem('quiz_osi_score')) / parseInt(localStorage.getItem('quiz_osi_total')) * 100
  };
  
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `quiz-osi-results-${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

// DÃ©marrer le chronomÃ¨tre au chargement
window.addEventListener('load', startTimer);
</script>
</body>
</html>